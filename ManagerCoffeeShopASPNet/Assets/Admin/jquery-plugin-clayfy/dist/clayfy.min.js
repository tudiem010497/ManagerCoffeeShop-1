!function(){function f(e,t){this.el=e instanceof $?e:$(e),this.draggableBox,this.x,this.y,this.dX,this.dY,this.diffDX,this.diffDY,this.history={dX:[0,0,0],dY:[0,0,0],diffDX:0,diffDY:0},this.actualPos,this.originalPos,this.initPos={y:0,x:0,scrollTop:null,scrollLeft:null},this.bounderies={},this.droppedTarget,this.scrollable=[],this.container={},this.tempContainer=$("<div>",{style:"position: absolute; top:0; left:0"}),this.droppable={dragElement:[],dropArea:[]},this.status="ready",this.settings=$.extend(!0,{},$.clayfy.settings,t);var i,o,b=this,r=!1,a=!0,n=!1,s=$("<div>",{style:"height:100%;width:100%;position:fixed;top:0;left:0"});this.contentGhost;var v,m,x,w,l=function(){b.settings.ghost?(!0===b.settings.ghost?(b.draggableBox=b.el.clone(),b.draggableBox.addClass("clayfy-ghost-opacity")):(b.draggableBox=$("<div>",{margin:b.el.css("margin")}),b.contentGhost=$('<div class="clayfy-ghost-content" style="position:absolute"></div>'),b.draggableBox.append(b.contentGhost)),b.draggableBox.css({position:"absolute",width:"100%",height:"100%"}).addClass("clayfy-ghost")):b.draggableBox=b.el},d=function(e){if("canceling"!==b.status&&b.settings.move){var t=b.getPosition(),i=b.draggableBox.offset();b.contentGhost?b.contentGhost:b.draggableBox;if(b.container.offset){var o=b.container.offset.innerBottom,r=b.container.offset.innerRight;i.top>=o-b.el.outerHeight()&&(t.y+=o-b.el.outerHeight()-i.top),i.left>=r-b.el.outerWidth()&&(t.x+=r-b.el.outerWidth()-i.left)}if(b.el.css({top:t.y,left:t.x}),"clayfy-dropinside"===e.type){o=e.area.offset.innerBottom,r=e.area.offset.innerRight;i.top>=o-b.el.outerHeight()&&(t.y+=o-b.el.outerHeight()-i.top),i.left>=r-b.el.outerWidth()&&(t.x+=r-b.el.outerWidth()-i.left),b.el.css({top:t.y,left:t.x})}}b.draggableBox.detach()},g=function(){var e=b.settings.container;e instanceof C?b.container=e:b.settings.container&&(b.container=new C(b.el,e))},p=function(e){27===e.keyCode&&b.cancel(e)};this.cancel=function(e){b.status="canceling",b.draggableBox.animate({top:b.initPos.y,left:b.initPos.x},100,function(){b.draggableBox.trigger("mouseup"),b.status="ready"}),null!==b.initPos.scrollTop&&b.initPos.parent.animate({scrollTop:b.initPos.scrollTop},100),null!==b.initPos.scrollLeft&&b.initPos.parent.animate({scrollLeft:b.initPos.scrollLeft},100)},b.scrollables=[];var f=function(){$(b.settings.scrollable).each(function(){var e=$(this);if(!e.length)return!0;var t=c(e);if(!t.x&&!t.y)return!0;var i=e[0].getBoundingClientRect(),o=h(e),r=parseInt(e.css("border-top-width")),a=parseInt(e.css("border-left-width")),n={el:e,top:i.top+r,bottom:i.top+o.innerHeight+r,left:i.left+a,right:i.left+o.innerWidth+a,innerHeight:o.innerHeight,innerWidth:o.innerWidth,interval:{top:!1,bottom:!1,left:!1,right:!1},isParent:!b.settings.overflow&&b.el.offsetParent().is(e),isBody:e.is("body")};if(n.isBody){var s=$(window);n.top=0,n.left=0,n.bottom=s.height(),n.right=s.width(),n.innerHeight=s.height(),n.innerWidth=s.width()}b.scrollables.push(n)})},c=function(e){var t=!1,i=!1,o=$(window),r=$("body");return e.is("body")?(r.height()>o.height()&&(i=!0),r.width()>o.width()&&(t=!0)):(e[0].scrollHeight>e.height()&&(i=!0),e[0].scrollWidth>e.width()&&(t=!0)),{x:t,y:i}},h=function(e){var t,i,o,r,a,n,s,l=e instanceof $?e:$(e);return l.length?(t=l[0].style.position,"static"===l.css("position")&&l.css({position:"relative"}),o=$("<div>",{style:"position:absolute;top:0;left:0;bottom:0;right:0"}),i=$("<div>",{style:"position:absolute;top:0;left:0;width:100%;height:100%"}),o.append(i),l.append(o),r=i.width(),a=i.height(),n=parseInt(i.css("border-top-width")),s=parseInt(i.css("border-left-width")),o.remove(),l[0].style.position=t,{innerWidth:r,innerHeight:a,innerOffset:{top:n,left:s,bottom:a+n,right:r+s}}):{width:0,height:0}};var u=function(e){var t,i,o=b.contentGhost?b.contentGhost:b.draggableBox,r=b.draggableBox[0].getBoundingClientRect(),a=o.offset(),n={top:r.top,bottom:r.top+o.outerHeight(),left:r.left,right:r.left+o.outerWidth(),x:0,y:0};n.x=(n.right-n.left)/2+n.left,n.y=(n.bottom-n.top)/2+n.top,0<b.history.diffDY&&v&&(v=!1,b.y=Math.min(a.top+o.outerHeight(),e.pageY)),b.history.diffDY<0&&m&&(m=!1,b.y=Math.max(a.top,e.pageY)),0<b.history.diffDX&&w&&(w=!1,b.x=Math.min(a.left+o.outerWidth(),e.pageX)),b.history.diffDX<0&&x&&(x=!1,b.x=Math.max(a.left,e.pageX));for(var s=0,l=b.scrollables.length;s<l;s++){var d=b.scrollables[s],g=0,p=n.top-d.top,f=d.bottom-n.bottom,c=n.left-d.left,h=d.right-n.right,u=n.x<d.right&&n.x>d.left,y=n.y<d.bottom&&n.y>d.top;if((i=d).el[0].scrollHeight-i.el.scrollTop()!==i.innerHeight&&f<6&&(-6<f||d.isBody)&&u?(z(e,d,"bottom"),B(d,"top"),g++):(B(d,"bottom"),d.el.scrollTop()&&p<6&&(-6<p||d.isBody)&&u?(z(e,d,"top"),g++):B(d,"top")),d.el.scrollLeft()&&c<6&&(-6<c||d.isBody)&&y?(z(e,d,"left"),B(d,"right"),g++):(B(d,"left"),(t=d).el[0].scrollWidth-t.el.scrollLeft()!==t.innerWidth&&h<6&&(-6<h||d.isBody)&&y?(z(e,d,"right"),g++):B(d,"right")),g)break}},z=function(t,i,e){i.interval[e]&&clearInterval(i.interval[e]);var o=function(e){};switch(e){case"bottom":o=function(e){e=e||10,i.el.scrollTop(i.el.scrollTop()+e),i.isParent&&(b.x=t.pageX,b.setBounderies(),b.updateDropArea(),v=!0)};break;case"top":o=function(e){e=e||10,i.el.scrollTop(i.el.scrollTop()-e),i.isParent&&(b.x=t.pageX,b.setBounderies(),b.updateDropArea(),m=!0)};break;case"left":o=function(e){e=e||10,i.el.scrollLeft(i.el.scrollLeft()-e),i.isParent&&(b.y=t.pageY,b.setBounderies(),b.updateDropArea(),x=!0)};break;case"right":o=function(e){e=e||10,i.el.scrollLeft(i.el.scrollLeft()+e),i.isParent&&(b.y=t.pageY,b.setBounderies(),b.updateDropArea(),w=!0)}}o(3),i.isParent||(i.interval[e]=setInterval(o,50))},B=function(e,t){if(t)e.interval[t]&&(clearInterval(e.interval[t]),e.interval[t]=!1);else for(var i in b.scrollables){var o=b.scrollables[i].interval;for(var r in o)o[r]&&(clearInterval(o[r]),o[r]=!1)}};this.appendTo=function(e,t){if(t=t||b.el,(e=e instanceof $?e:$(e)).length){var i=t.offset(),o=e.offset(),r={top:i.top-o.top-parseInt(e.css("border-top-width"))+e.scrollTop(),left:i.left-o.left-parseInt(e.css("border-left-width"))+e.scrollLeft()};"static"===e.css("position")&&e.css("position","relative"),t.appendTo(e).css(r)}};var y=function(){b.el.on("clayfy-dragstart",b.updateDragElement),b.el.on("clayfy-dragstart",b.updateDropArea),b.el.on("clayfy-drag",P),b.el.on("clayfy-drop",D),b.settings.ghost&&(b.el.on("clayfy-dropinside",d),b.el.on("clayfy-dropoutside",d)),b.el.on("clayfy-dragstart",function(){H()||(b.el.removeClass("clayfy-dropinside"),b.draggableBox.removeClass("clayfy-dropinside"))}),b.el.on("clayfy-dragenter",function(e){b.el.addClass("clayfy-dragenter"),b.draggableBox.addClass("clayfy-dragenter"),e.droparea.addClass("clayfy-dragenter"),b.el[0].id&&e.droparea.addClass("clayfy-dragenter-"+b.el[0].id)}),b.el.on("clayfy-dragleave",function(e){b.el.removeClass("clayfy-dropinside"),b.draggableBox.removeClass("clayfy-dropinside"),e.droparea.removeClass("clayfy-dropinside"),b.el[0].id&&e.droparea.removeClass("clayfy-dropinside-"+b.el[0].id)}),b.el.on("clayfy-dragleave clayfy-drop",function(e){b.el.removeClass("clayfy-dragenter"),b.draggableBox.removeClass("clayfy-dragenter"),$(".clayfy-dragenter").removeClass("clayfy-dragenter"),b.el[0].id&&$(".clayfy-dragenter-"+b.el[0].id).removeClass("clayfy-dragenter-"+b.el[0].id)}),b.el.on("clayfy-dropinside",function(e){b.el.addClass("clayfy-dropinside"),b.draggableBox.addClass("clayfy-dropinside"),e.droparea.addClass("clayfy-dropinside"),b.el[0].id&&e.droparea.addClass("clayfy-dropinside-"+b.el[0].id),b.settings.migrate&&b.appendTo(e.droparea)})};this.updateDropArea=function(e){b.droppable.dropArea=[];var t=b.settings.droppable instanceof $?b.settings.droppable:$(b.settings.droppable);b.addDroppable(t)},this.updateDragElement=function(){b.droppable.dragElement=[],b.droppable.dragElement={originalPos:b.getPosition(),id:b.el[0].id,originalDropArea:null,width:b.draggableBox.width(),height:b.draggableBox.height(),outerWidth:b.draggableBox.outerWidth(),outerHeight:b.draggableBox.outerHeight(),x:0,y:0};var t=b.droppable.dragElement;t.setCenter=function(){var e=b.draggableBox.offset();t.x=e.left+t.outerWidth/2,t.y=e.top+t.outerHeight/2},t.setCenter(),t.originalDropArea=H()},this.resetDroppable=function(e){e&&(b.settings.droppable=e),b.updateDragElement(),b.updateDropArea()},this.addDroppable=function(e){(e instanceof $?e:$(e)).each(function(){var e=$(this),t=e.offset(),i=e.outerHeight(),o=e.outerWidth(),r=parseInt(e.css("border-top-width")),a=parseInt(e.css("border-left-width")),n=$.clayfy.getInner(e);b.droppable.dropArea.push({el:e,id:this.id,left:t.left,top:t.top,width:o,height:i,innerWidth:n.innerWidth,innerHeight:n.innerHeight,offset:{innerTop:t.top+r,innerLeft:t.left+a,innerBottom:n.innerHeight+t.top+r,innerRight:n.innerWidth+t.left+a},right:t.left+o,bottom:t.top+i,active:!1,triggered:!1})})};var P=function(e){var t=b.droppable.dragElement;t.setCenter();for(var i=0,o=b.droppable.dropArea.length;i<o;i++){var r=b.droppable.dropArea[i];r&&(t.x>r.left&&t.x<r.right&&t.y>r.top&&t.y<r.bottom?r.active=!0:r.active=!1,!r.triggered&&r.active?(r.triggered=!0,b.el.trigger($.Event("clayfy-dragenter",{target:r.el[0],droparea:r.el}))):r.triggered&&!r.active&&(r.triggered=!1,b.el.trigger($.Event("clayfy-dragleave",{target:r.el[0],droparea:r.el,area:r}))))}},H=function(){var e=b.droppable.dragElement;e.setCenter();for(var t=!1,i=0,o=b.droppable.dropArea.length;i<o;i++){var r=b.droppable.dropArea[i];r&&(e.x>r.left&&e.x<r.right&&e.y>r.top&&e.y<r.bottom&&(r.active=!0,r.triggered=!0,t=r))}return t},D=function(){for(var e,t,i,o,r,a,n,s,l,d,g=0,p=b.droppable.dropArea.length;g<p;g++)b.droppable.dropArea[g].active&&(e=b.droppable.dropArea[g]);if("canceling"===b.status){if(e&&(e.active=!1,e.triggered=!1,b.el.trigger($.Event("clayfy-dragleave",{target:e.el[0],droparea:e.el}))),!(e=b.droppable.dragElement.originalDropArea))return;e.active=!0,e.triggered=!0}e?(b.el.trigger($.Event("clayfy-dropinside",{target:e.el[0],droparea:e.el,area:e})),b.settings.fit&&(i=e,o=b.contentGhost?b.contentGhost:b.draggableBox,r={},a=b.el.offset(),n=a.top,s=a.left,l=b.droppable.dragElement.outerWidth+a.left,d=b.droppable.dragElement.outerHeight+a.top,o.outerWidth()<=i.innerWidth&&(l>i.offset.innerRight&&(r.left=parseInt(o.css("left"))+i.offset.innerRight-l),s<i.offset.innerLeft&&(r.left=parseInt(o.css("left"))+i.offset.innerLeft-s)),o.outerHeight()<=i.innerHeight&&(d>i.offset.innerBottom&&(r.top=parseInt(o.css("top"))+i.offset.innerBottom-d),n<i.offset.innerTop&&(r.top=parseInt(b.el.css("top"))+i.offset.innerTop-n)),b.el.css(r))):(b.el.trigger("clayfy-dropoutside"),b.settings.dropoutside||((t=b.droppable.dragElement.originalDropArea)&&b.el.trigger($.Event("clayfy-dropinside",{target:t.el[0],droparea:t.el})),b.settings.overflow&&!b.settings.ghost?b.el.css({left:b.initPos.x-b.initPos.parent.offset().left-parseInt(b.initPos.parent.css("border-left-width"))+b.initPos.scrollLeft,top:b.initPos.y-b.initPos.parent.offset().top-parseInt(b.initPos.parent.css("border-top-width"))+b.initPos.scrollTop}):b.el.css({left:b.initPos.x,top:b.initPos.y})),b.settings.dropoutside&&b.settings.migrate&&b.settings.overflow&&b.appendTo(b.tempContainer)),e&&(b.droppedTarget=e.el[0])},S=function(e){o.is(e.target)||b.el.has(e.target).length&&!b.settings.propagate||(isTouchDevice()||void 0===e.which||1===e.which)&&function(e){var t=e.pageX-b.el.offset().left,i=e.pageY-b.el.offset().top,o=$("<div>",{style:"position:absolute;left:0;top:0;width:100%;height:100%"});b.el.append(o);var r=o.width(),a=o.height();return o.remove(),!(r<t||a<i)}(e)&&(document.body.style.cursor=i,r=!0,$(document).on("mousemove touchmove",W).on("mouseup touchend",X))},X=function(e){if(r&&(document.body.style.cursor="",a=!(r=!1),n)){n=!1,e.preventDefault(),b.settings.overflow&&(b.appendTo(b.initPos.parent,b.draggableBox),b.appendTo(b.initPos.parent)),b.settings.coverScreen&&T(),b.settings.drop.call(b);var t=$.Event("clayfy-drop",{pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY});b.el.trigger(t),$(document).off("mousemove touchmove",W).off("mouseup touchend",X)}},Y=function(e){n=!(a=!1),b.settings.coverScreen&&A(),b.settings.dragstart.call(b,e),b.el.trigger("clayfy-dragstart");var t=b.el.parent();b.initPos.parent=t,b.settings.overflow&&b.appendTo(b.tempContainer,b.draggableBox),b.settings.ghost&&function(e){var t=b.getPosition(b.el),i=b.settings.overflow?b.tempContainer:b.el.parent(),o=b.el.offset(),r=b.initPos.parent?b.initPos.parent.scrollTop():0,a=b.initPos.parent?b.initPos.parent.scrollLeft():0,n={width:b.el.width(),height:b.el.height(),top:t.y,left:t.x};if(!0!==b.settings.ghost&&(n={top:e.pageY-o.top+t.y+5-r,left:e.pageX-o.left+t.x+5-a,width:"auto",height:"auto"}),b.settings.overflow&&(n.top=o.top-r,n.left=o.left-a,!0!==b.settings.ghost&&(n.top=e.pageY-r+5,n.left=e.pageX-a+5)),b.draggableBox.css(n),b.draggableBox.appendTo(i),b.contentGhost){var s;switch(b.contentGhost.html(""),typeof b.settings.ghost){case"string":s=b.settings.ghost;break;case"function":s=b.settings.ghost()}if(b.contentGhost.append(s),b.container.offset){var l=b.container.offset.innerBottom,d=b.container.offset.innerRight,g=b.draggableBox.offset(),p=g.top+b.contentGhost.outerHeight()-l,f=g.left+b.contentGhost.outerWidth()-d;0<p&&b.draggableBox.css({top:e.pageY-o.top+t.y+5-p}),0<f&&b.draggableBox.css({left:e.pageX-o.left+t.x+5-f})}}}(e),b.x=e.pageX,b.y=e.pageY,b.setBounderies();var i=b.getPosition(b.el);b.initPos={x:i.x,y:i.y,scrollLeft:t.scrollLeft(),scrollTop:t.scrollTop(),parent:t},b.history={dX:[0,0,0],dY:[0,0,0],diffDX:0,diffDY:0}},W=function(e){if(r){if(e.preventDefault(),e.originalEvent.touches&&1==e.originalEvent.touches.length)e=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];a&&Y(e),b.dX=e.pageX-b.x,b.dY=e.pageY-b.y,$.clayfy.dX=b.dX,$.clayfy.dY=b.dY,b.history.diffDX=(b.history.dX[0]+b.history.dX[1]-(b.history.dX[2]+b.dX))/2,b.history.diffDY=(b.history.dY[0]+b.history.dY[1]-(b.history.dY[2]+b.dY))/2,b.history.dX=[b.history.dX[1],b.history.dX[2],b.dX],b.history.dY=[b.history.dY[1],b.history.dY[2],b.dY],b.fixDeltasWithBounderies(),(b.settings.move||b.settings.ghost)&&b.move(),b.settings.drag.call(b,e);var t=$.Event("clayfy-drag",{shiftKey:e.shiftKey,pageX:e.pageX,pageY:e.pageY,clientX:e.clientX,clientY:e.clientY,screenX:e.screenX,screenY:e.screenY,altKey:e.altKey});b.el.trigger(t)}},A=function(){$("body").append(s)},T=function(){s.detach()};this.getContainerBounderies=function(){if(!b.container.type)return!1;var e,t,i=b.draggableBox.offset(),o={};return b.container.update(),e=b.contentGhost?b.contentGhost.outerWidth():b.draggableBox.outerWidth(),t=b.contentGhost?b.contentGhost.outerHeight():b.draggableBox.outerHeight(),o={top:i.top-b.container.offset.innerTop,right:b.container.offset.innerRight-i.left-e,bottom:b.container.offset.innerBottom-i.top-t,left:i.left-b.container.offset.innerLeft},isNaN(o.top)&&(o={top:1e13,right:1e13,bottom:1e13,left:1e13}),o},this.setBounderies=function(){var e=b.settings.bounderies;b.actualPos=b.getPosition(),b.bounderies={top:-e[0],right:e[1],bottom:e[2],left:-e[3]};var t=b.getContainerBounderies();t&&(b.bounderies={top:Math.max(-t.top,b.bounderies.top),right:Math.min(t.right,b.bounderies.right),bottom:Math.min(t.bottom,b.bounderies.bottom),left:Math.max(-t.left,b.bounderies.left)})},this.move=function(){b.draggableBox.css({top:b.actualPos.y+$.clayfy.dY,left:b.actualPos.x+$.clayfy.dX})},this.getPosition=function(e){var t=b.el.offsetParent(),i=(void 0===e?b.draggableBox||b.el:e).position();return{y:i.top+t.scrollTop(),x:i.left+t.scrollLeft()}},this.fixDeltasWithBounderies=function(){$.clayfy.dX>b.bounderies.right&&($.clayfy.dX=b.bounderies.right),$.clayfy.dX<b.bounderies.left&&($.clayfy.dX=b.bounderies.left),$.clayfy.dY<b.bounderies.top&&($.clayfy.dY=b.bounderies.top),$.clayfy.dY>b.bounderies.bottom&&($.clayfy.dY=b.bounderies.bottom),b.settings.moveX||($.clayfy.dX=0),b.settings.moveY||($.clayfy.dY=0)},this.destroy=function(){},b.originalPos=b.getPosition(),b.actualPos=b.originalPos,g(),l(),b.el.addClass("clayfy-box"),b.settings.move||b.el.addClass("clayfy-not-move"),i=b.el.css("cursor"),o=$(b.settings.not),b.settings.overflow&&$("body").append(b.tempContainer),b.el.on("mousedown touchstart",S),b.settings.escape&&(b.el.on("clayfy-dragstart",function(e){e.stopPropagation(),$(window).on("keydown",p)}),b.el.on("clayfy-drop",function(){$(window).off("keydown",p)})),!1!==b.settings.scrollable&&"node"===b.container.type&&(b.settings.container instanceof C||("string"==typeof b.settings.scrollable?b.settings.scrollable=b.settings.scrollable?b.settings.scrollable+" , "+b.settings.container:b.settings.container:b.settings.scrollable instanceof $&&(b.settings.scrollable=b.settings.scrollable.add(b.settings.container)))),b.el.on("clayfy-dragstart",f),b.el.on("clayfy-drag",u),b.el.on("clayfy-drop",B),0!=b.settings.droppable?(b.updateDragElement(),b.updateDropArea(),y()):b.settings.ghost&&b.el.on("clayfy-drop",d)}function C(e,t){this.draggableEl=e instanceof $?e:$(e),this.values,this.el,this.type,this.originalDraggable,this.width=0,this.height=0,this.innerHeight=0,this.innerWidth=0,this.offset={top:0,left:0,innerBottom:0,innerRight:0,innerLeft:0,innerTop:0};var i=this,o=function(){var e=a(i.el);i.width=i.el.width(),i.height=i.el.height(),i.innerWidth=e.innerWidth,i.innerHeight=e.innerHeight,i.offset=i.el.offset(),i.offset.innerTop=i.offset.top+parseInt(i.el.css("border-top-width")),i.offset.innerLeft=i.offset.left+parseInt(i.el.css("border-left-width")),i.offset.innerBottom=i.offset.innerTop+i.innerHeight,i.offset.innerRight=i.offset.innerLeft+i.innerWidth},r=function(){var e=i.getDraggableValues();i.offset={top:e.offset.top-(e.position.top-i.originalDraggable.position.top)-i.values[0],left:e.offset.left-(e.position.left-i.originalDraggable.position.left)-i.values[3]},i.width=i.originalDraggable.outerWidth+i.values[3]+i.values[1],i.height=i.originalDraggable.outerHeight+i.values[0]+i.values[2],i.innerWidth=i.width,i.innerHeight=i.height,i.offset.innerTop=i.offset.top,i.offset.innerLeft=i.offset.left,i.offset.innerBottom=i.offset.top+i.height,i.offset.innerRight=i.offset.left+i.width},a=function(e){var t,i,o,r,a,n=e instanceof $?e:$(e);return n.length?(t=n[0].style.position,"static"===n.css("position")&&n.css({position:"relative"}),o=$("<div>",{style:"position:absolute;top:0;left:0;bottom:0;right:0"}),i=$("<div>",{style:"position:absolute;top:0;left:0;width:100%;height:100%"}),o.append(i),n.append(o),r=i.width(),a=i.height(),o.remove(),n[0].style.position=t,{innerWidth:r,innerHeight:a}):{width:0,height:0}};this.getDraggableValues=function(){var e=i.draggableEl.offset(),t=i.draggableEl.offsetParent();return{position:{top:i.draggableEl.position().top+t.scrollTop(),left:i.draggableEl.position().left+t.scrollLeft()},offset:e,outerWidth:i.draggableEl.outerWidth(),outerHeight:i.draggableEl.outerHeight()}},"string"==typeof t||t instanceof $?(i.el=t instanceof $?t:$(t),i.type="node","static"===i.el.css("position")&&i.el.css("position","relative"),i.update=o):(i.values=t,i.type="object",i.update=r,i.originalDraggable=i.getDraggableValues()),i.update()}function r(e,t){this.el=e instanceof $?e:$(e),this.originalSize={},this.initSize={},this.handlers=[],this.actualSize,this.newSize,this.draggable,this.preserveAspectRatio=!1,this.shift=!1,this.status="ready",this.touchableDevice;var i=$.extend(!0,{},$.clayfy.settings,{callbacks:{resizestart:function(){},resize:function(){},resizeend:function(){}}});this.settings=$.extend(!0,{},i,t);var o,n=this,r=!1,a=function(e){27===e.keyCode&&n.cancel()},s=function(){var e=["top left","top right","bottom left","bottom right","left","right","top","bottom"];n.touchableDevice&&(e=["bottom right"]),"static"===n.el.css("position")&&n.el.css("position","relative"),n.cssPosition=n.el.css("position");var t={container:n.settings.container,not:".clayfy-handler",escape:!1,droppable:n.settings.droppable};t=$.extend(!0,{},n.settings,t),n.settings.not&&(t.not+=","+n.settings.not),n.settings.move&&"relative"!==n.cssPosition||(t.move=!1),n.draggable=new f(n.el,t);for(var i=0;i<e.length;i++){var o=e[i].split(" "),r=!0;for(var a in o)n.settings.hasOwnProperty(o[a])&&n.settings[o[a]]||(r=!1);r&&n.handlers.push(new l(e[i],n))}n.touchableDevice&&n.el.addClass("clayfy-touch-device")};this.getSize=function(){n.parent=n.el.offsetParent();var e=n.parent,t=n.el.position();return{width:n.el.width(),height:n.el.height(),left:t.left+e.scrollLeft(),top:t.top+e.scrollTop(),outerWidth:n.el.outerWidth(),outerHeight:n.el.outerHeight()}},this.getNewSize=function(){var e=n.el.outerHeight(),t=n.el.outerWidth(),i=n.el.position(),o=i.left+n.parent.scrollLeft(),r=i.top+n.parent.scrollTop();return{outerWidth:t,outerHeight:e,top:r,left:o,right:o+t,bottom:r+e,width:n.el.width(),height:n.el.height()}},this.resize={left:function(){n.el.width(n.actualSize.width-$.clayfy.dX),"relative"!==n.cssPosition&&n.el.css({left:n.actualSize.left+$.clayfy.dX})},top:function(){n.el.height(n.actualSize.height-$.clayfy.dY),"relative"!==n.cssPosition&&n.el.css({top:n.actualSize.top+$.clayfy.dY})},bottom:function(){n.el.height(n.actualSize.height+$.clayfy.dY)},right:function(){n.el.width(n.actualSize.width+$.clayfy.dX)}},this.hideHandlers=function(){"ready"===n.status&&($.each(n.handlers,function(e,t){t.el.css("display","none")}),r=!1)},this.showHandlers=function(){r||"ready"!==n.status&&!n.touchableDevice||($.each(n.handlers,function(e,t){t.el.css("display","block")}),r=!0,n.updateHandlersPosition())},this.updateHandlersPosition=function(){n.newSize=n.getNewSize(),$.each(n.handlers,function(e,t){t.updatePosition()})},this.cancel=function(){console.log("cancelled"),n.status="ready",n.hideHandlers(),n.status="canceling",$("body").trigger("mouseup");var e="relative"!==n.cssPosition?n.initSize:{width:n.initSize.width,height:n.initSize.height};n.el.animate(e,100,function(){n.status="ready",n.el.is(":hover")&&n.showHandlers(),n.el.trigger("clayfy-cancel")})},function(){n.touchableDevice=isTouchDevice(),n.originalSize=n.getSize(),n.actualSize=n.originalSize,n.newSize=n.getNewSize(),s(),n.preserveAspectRatio=n.settings.preserveAspectRatio,n.el.on("clayfy-resizestart",function(e){n.initSize=n.getNewSize(),$(window).on("keydown",a),n.status="resizing"}),n.el.on("clayfy-resizeend",function(){$(window).off("keydown",a),n.status="ready"}),n.el.on("clayfy-dragstart",function(e){e.stopPropagation(),n.initSize=n.getSize(),n.status="dragging"}),n.el.on("clayfy-drop",function(e){e.stopPropagation(),n.status="ready"}),n.el.on("clayfy-resize clayfy-drag",n.updateHandlersPosition),$(window).on("resize",n.updateHandlersPosition),n.el.on("clayfy-dragstart",function(e){e.stopPropagation(),$(window).on("keydown",a)}),n.el.on("clayfy-drop",function(e){e.stopPropagation(),$(window).off("keydown",a)});var i=n.el;$.each(n.handlers,function(e,t){n.hideHandlers(),i=i.add(t.el)}),i.on("mouseover",function(){o&&clearTimeout(o),n.showHandlers()}),i.on("mouseout",function(){o=setTimeout(n.hideHandlers,20)}),n.el.on("clayfy-resizeend clayfy-drop",function(e){e.stopPropagation(),n.el.parent().find(":hover").length||n.touchableDevice||(r=!1,n.el.trigger("mouseout"))}),n.touchableDevice&&(i.on("touchstart",function(){o&&clearTimeout(o),n.showHandlers(),o=setTimeout(n.hideHandlers,4e3)}),n.el.on("clayfy-resizeend clayfy-drop",function(){n.el.trigger("click")}))}()}function l(t,i){this.el=$("<div>",{class:"clayfy-handler clayfy-"+t,style:"position: absolute"}),this.resizable=i,this.position=t,this.draggable;var d=this,o=!1;this.updatePosition=function(){var e=i.newSize;switch(d.position){case"left":d.el.css({width:5,left:e.left,top:e.top,height:e.outerHeight});break;case"right":d.el.css({width:5,left:e.right-5,top:e.top,height:e.outerHeight});break;case"top":d.el.css({height:5,left:e.left,top:e.top,width:e.outerWidth});break;case"bottom":d.el.css({height:5,left:e.left,top:e.bottom-5,width:e.outerWidth});break;case"top left":d.el.css({width:8,height:8,left:e.left,top:e.top});break;case"top right":d.el.css({width:8,height:8,left:e.right-8,top:e.top});break;case"bottom left":d.el.css({width:8,height:8,left:e.left,top:e.bottom-8});break;case"bottom right":d.resizable.touchableDevice?d.el.css({width:18,height:18,left:e.right-20,top:e.bottom-20}):d.el.css({width:8,height:8,left:e.right-8,top:e.bottom-8})}},this.setBounderies=function(e){var t,i,o,r,a=e||[1e5,1e5,1e5,1e5],n=[];d.resizable.actualSize=d.resizable.getSize(),t=d.resizable.actualSize,i=d.resizable.settings,o=d.resizable.originalSize.width/d.resizable.originalSize.height,(r=d.draggable.getContainerBounderies())||(r={top:1e13,right:1e13,bottom:1e13,left:1e13});for(var s=0,l=i.maxSize.length;s<l;s++)null===i.maxSize[s]&&(i.maxSize[s]=1e13);$.clayfy.getInner(d.draggable.el);"left"!==d.position&&"top"!==d.position&&"top left"!==d.position||(a[1]=t.outerWidth-i.minSize[0],a[3]=i.maxSize[0]-t.outerWidth,a[2]=t.outerHeight-i.minSize[1],a[0]=i.maxSize[1]-t.outerHeight,d.draggable.settings.bounderies=a,n[3]=Math.min(r.left,a[3],r.top*o,a[0]*o),n[0]=Math.min(r.top,a[0],r.left/o,a[3]/o),n[1]=Math.min(r.right,a[1],r.bottom*o+a[2],a[2]*o),n[2]=Math.min(r.bottom,a[2],r.right/o+a[1],a[1]/o)),"right"!==d.position&&"bottom"!==d.position&&"bottom right"!==d.position||(a[3]=t.outerWidth-i.minSize[0],a[1]=i.maxSize[0]-t.outerWidth,a[0]=t.outerHeight-i.minSize[1],a[2]=i.maxSize[1]-t.outerHeight,d.draggable.settings.bounderies=a,n[1]=Math.min(r.right,a[1],r.bottom*o,a[2]*o),n[2]=Math.min(r.bottom,a[2],r.right/o,a[1]/o),n[3]=Math.min(r.left,a[3],r.top*o+a[0],a[0]*o),n[0]=Math.min(r.top,a[0],r.left/o+a[3],a[3]/o)),"bottom left"===d.position&&(a[0]=t.outerHeight-i.minSize[1],a[1]=t.outerWidth-i.minSize[0],a[2]=i.maxSize[1]-t.outerHeight,a[3]=i.maxSize[0]-t.outerWidth,d.draggable.settings.bounderies=a,n[3]=parseInt(Math.min(r.left,a[3],r.bottom*o,a[2]*o)),n[2]=parseInt(Math.min(r.bottom,a[2],r.left/o,a[3]/o)),n[0]=parseInt(Math.min(r.top,a[0],r.right/o+a[1],a[1]/o)),n[1]=parseInt(Math.min(r.right,a[1],r.top*o+a[0],a[0]*o))),"top right"===d.position&&(a[0]=i.maxSize[1]-t.outerHeight,a[1]=i.maxSize[0]-t.outerWidth,a[2]=t.outerHeight-i.minSize[1],a[3]=t.outerWidth-i.minSize[0],d.draggable.settings.bounderies=a,n[0]=parseInt(Math.min(r.top,a[0],r.right/o,a[1]/o)),n[1]=parseInt(Math.min(r.right,a[1],r.top*o,a[0]*o)),n[3]=parseInt(Math.min(r.left,a[3],r.bottom*o+a[2],a[2]*o)),n[2]=parseInt(Math.min(r.bottom,a[2],r.left/o+a[3],a[3]/o))),d.originalBounderies={top:-a[0],right:a[1],bottom:a[2],left:-a[3]},d.aspectRatioBounderies={top:-n[0],right:n[1],bottom:n[2],left:-n[3]},d.draggable.bounderies=d.resizable.preserveAspectRatio?d.aspectRatioBounderies:d.originalBounderies},this.fixDeltas=function(){var e=$.clayfy;if(d.resizable.preserveAspectRatio)var t=d.resizable.originalSize.width/d.resizable.originalSize.height;if(!d.resizable.preserveAspectRatio&&d.resizable.shiftKey)t=d.resizable.actualSize.width/d.resizable.actualSize.height;(d.resizable.preserveAspectRatio||d.resizable.shiftKey)&&("right"===d.position&&(e.dY=e.dX/t),"bottom"===d.position&&(e.dX=e.dY*t),"left"===d.position&&(e.dY=e.dX/t),"top"===d.position&&(e.dX=e.dY*t),"top left"===d.position&&(e.dY=e.dX/t),"top right"===d.position&&(e.dY=-e.dX/t),"bottom left"===d.position&&(e.dY=-e.dX/t),"bottom right"===d.position&&(e.dY=e.dX/t))},i.settings.className&&d.el.addClass(i.settings.className),d.updatePosition(),d.resizable.el.after(d.el),d.draggable=new f(d.el,{move:!1,container:i.draggable.container,scroll:!1,escape:!1}),d.draggable.el.on("clayfy-drop",function(e){i.el.trigger("clayfy-resizeend"),i.settings.callbacks.resizeend()}),d.draggable.el.on("clayfy-dragstart",function(e){e.stopPropagation(),d.resizable.preserveAspectRatio||(d.resizable.originalSize=d.resizable.getSize()),i.el.trigger("clayfy-beforeresize"),d.setBounderies(),i.el.trigger("clayfy-resizestart"),i.settings.callbacks.resizestart(),o=!1}),d.draggable.el.on("clayfy-drag",function(e){e.shiftKey&&!i.preserveAspectRatio&&(i.shiftKey=!0),e.shiftKey||(i.shiftKey=!1),!o||e.shiftKey||i.preserveAspectRatio||(console.log("Desactivate: preserve aspect ratio"),d.draggable.bounderies=d.originalBounderies,o=!1),o||!e.shiftKey||i.preserveAspectRatio||(console.log("Activate: preserve aspect ratio"),d.draggable.bounderies=d.aspectRatioBounderies,o=!0),i.preserveAspectRatio&&!i.shiftKey&&(d.draggable.bounderies=d.aspectRatioBounderies)}),-1<t.indexOf("left")&&d.draggable.el.on("clayfy-drag",function(e){(i.preserveAspectRatio||i.shiftKey)&&(d.fixDeltas(),"left"===t&&i.resize.top()),i.resize.left()}),-1<t.indexOf("top")&&d.draggable.el.on("clayfy-drag",function(e){(i.preserveAspectRatio||i.shiftKey)&&(d.fixDeltas(),"top"===t&&i.resize.left()),i.resize.top()}),-1<t.indexOf("right")&&d.draggable.el.on("clayfy-drag",function(e){(i.preserveAspectRatio||i.shiftKey)&&(d.fixDeltas(),"right"===t&&i.resize.bottom()),i.resize.right()}),-1<t.indexOf("bottom")&&d.draggable.el.on("clayfy-drag",function(e){(i.preserveAspectRatio||i.shiftKey)&&(d.fixDeltas(),"bottom"===t&&i.resize.right()),i.resize.bottom()}),d.draggable.el.on("clayfy-drag",function(e){i.el.trigger("clayfy-resize"),i.settings.callbacks.resize()}),d.resizable.touchableDevice&&d.el.addClass("clayfy-touch-device")}function a(e,t){this.el=e instanceof $?e:$(e),this.draggableBox,this.dropArea=$("<div>",{class:"clayfy-sort-droparea"}),this.draggable,this.droppable,this.droppableParent,this.index,this.indexRelative,this.parent,this.settings=$.extend(!0,{},$.clayfy.settings,t);var a,n=this,i=function(e){27===e.keyCode&&n.cancel()},o=function(){n.draggableBox=n.el.clone(),n.draggableBox.css({position:"absolute",width:"100%",height:"100%"}).addClass("clayfy-sort-dragging");var e=n.el.parent();"static"===e.css("position")&&e.css("position","relative")},r=function(){g(),p(),n.index=n.droppable.index(n.el),n.parent=n.el.parent(),n.indexRelative=n.parent.find(n.droppable).index(n.el),n.draggableBox.css({width:n.el.outerWidth(),height:n.el.outerHeight(),top:n.el.position().top,left:n.el.position().left}),s(),n.draggableBox.appendTo(n.parent),n.el.css({visibility:"hidden"})},s=function(){n.dropArea.appendTo(n.el.parent()),n.dropArea.css({position:"absolute",width:n.el.outerWidth(),height:n.el.outerHeight(),top:n.el.position().top+parseInt(n.el.css("margin-top"))-parseInt(n.dropArea.css("border-top-width")),left:n.el.position().left+parseInt(n.el.css("margin-left"))-parseInt(n.dropArea.css("border-left-width"))})},l=function(e){g(),(!1===n.el.triggerHandler("validateChange")||!n.parent.is($(n.droppedTarget).parent())&&!n.settings.export||a)&&function(e){var t=n.parent.find(n.droppable);if(n.parent.is($(n.droppedTarget).parent())){var i=t.index(n.el);n.indexRelative<i?t.eq(n.indexRelative).before(n.el):t.eq(n.indexRelative).after(n.el)}else t.length?t.eq(n.indexRelative).before(n.el):n.parent.append(n.el);s()}();var t=n.dropArea.parent().offset(),i=n.draggableBox.parent().offset(),o=n.el.position().left+(t.left-i.left),r=n.el.position().top+(t.top-i.top);return n.draggableBox.animate({top:r,left:o},200,function(){n.dropArea.detach(),n.el[0].style.visibility="",n.draggableBox.detach(),g();var e=n.droppable.index(n.el);e!=n.index&&(n.index=e,n.el.trigger($.Event("clayfy-changeorder",{index:n.index,order:n.droppable}))),n.el.parent().find(".clayfy-sort-helper").remove()}),a=!1},d=function(e){if(!n.el.is(e.target)){g();var t=n.droppable.index(e.target),i=n.droppable.index(n.el);n.droppedTarget=e.target,i<t?$(e.target).after(n.el):$(e.target).before(n.el),s(),n.draggable.updateDropArea(),n.parent.find(n.droppable).length<2?n.parent.find(".clayfy-sort-helper").length||n.parent.append('<div class="clayfy-sort-helper" style="position: absolute; width: 100%; height: 100%; top: 0; left:0"></div>'):n.parent.find(".clayfy-sort-helper").remove(),$(".clayfy-sort-helper").each(function(){var e=$(this);e.parent().is(n.droppableParent)&&n.draggable.addDroppable(e)})}},g=function(){n.settings.siblings?n.droppable=n.settings.siblings instanceof $?n.settings.siblings:$(n.settings.siblings):n.droppable=n.el.siblings().andSelf()},p=function(){n.droppableParent||(n.droppableParent=n.el.parent()),n.droppable.each(function(){n.droppableParent=n.droppableParent.add($(this).parent())})};this.cancel=function(){a=!0,$("body").trigger("mouseup")},function(){g(),p(),o(),n.el.on("mousedown touchstart",function(e){"mousedown"===e.type&&1!==e.which||(r(),n.draggableBox.trigger($.Event(e.type,e)))});var e=$.extend(!0,{},n.settings,{droppable:n.droppable,escape:!1,dropoutside:!0});n.draggable=new f(n.draggableBox,e),n.draggableBox.on("clayfy-drop",l),n.draggableBox.on("clayfy-dropoutside",function(e){return!1}),n.draggableBox.on("clayfy-dragenter",d),n.draggableBox.on("clayfy-dragstart",function(){n.draggable.resetDroppable(n.droppable),$(".clayfy-sort-helper").each(function(){var e=$(this);e.parent().is(n.droppableParent)&&n.draggable.addDroppable(e)})}),n.draggableBox.on("clayfy-dragstart",function(e){e.stopPropagation(),$(window).on("keydown",i)}),n.draggableBox.on("clayfy-drop",function(){$(window).off("keydown",i)})}()}$.clayfy={dX:0,dY:0,container:function(e,t){return new C(e,t)},settings:{type:"draggable",bounderies:[1e7,1e7,1e7,1e7],container:"",moveX:!0,moveY:!0,move:!0,not:"",ghost:!1,coverScreen:!0,scrollable:"",droppable:"",fit:!0,dropoutside:!1,migrate:!1,overflow:!1,escape:!0,propagate:!0,preserveAspectRatio:!1,maxSize:[500,200],minSize:[100,50],left:!0,top:!0,right:!0,bottom:!0,className:"",siblings:"",export:!0,dragstart:function(e){},drag:function(e){},drop:function(e){}},getInner:function(e){var t,i,o,r,a,n=e instanceof $?e:$(e);return n.length?(t=n[0].style.position,"static"===n.css("position")&&n.css({position:"relative"}),o=$("<div>",{style:"position:absolute;top:0;left:0;bottom:0;right:0"}),i=$("<div>",{style:"position:absolute;top:0;left:0;width:100%;height:100%"}),o.append(i),n.append(o),r=i.width(),a=i.height(),o.remove(),n[0].style.position=t,{innerWidth:r,innerHeight:a}):{width:0,height:0}}};var n,s="clayfy";$.fn[s]=function(t){var i=arguments;if(void 0===t||"object"==typeof t){var e=$.clayfy.settings.type;switch(void 0!==t&&void 0!==t.type&&(e=t.type),e){case"draggable":n=f;break;case"resizable":n=r;break;case"sortable":n=a}return this.each(function(){$.data(this,s)||$.data(this,s,new n(this,t))})}if("string"==typeof t&&"_"!==t[0]&&"init"!==t){if("instance"===t)return this.length?$.data(this[0],s):null;if(0!=Array.prototype.slice.call(i,1).length||-1==$.inArray(t,$.fn[s].getters))return this.each(function(){var e=$.data(this,s);"function"==typeof e[t]&&e[t].apply(e,Array.prototype.slice.call(i,1))});var o=$.data(this[0],s);return o[t].apply(o,Array.prototype.slice.call(i,1))}},$.fn[s].getters=["getPosition"]}(jQuery),isTouchDevice=function(){return"ontouchstart"in window||navigator.maxTouchPoints};
